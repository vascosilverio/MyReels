{
	"id": "c5f85a10-d7d2-421e-b0df-381ba391ea36",
	"createdAt": "2024-07-07T21:15:13.014Z",
	"createdBy": "admin",
	"globalScripts": [],
	"externalModules": [],
	"entitySets": [
		{
			"id": "7850ec31-7369-4a8b-a109-2b0d773cc88f",
			"name": "collections",
			"contextname": "collections"
		}
	],
	"apis": [
		{
			"id": "4902a562-d19a-4e1c-8bfa-d4f0f3219728",
			"parent": "be2c5fd8-53bc-4307-8b7e-94c5d59ee076",
			"name": "/collections",
			"contextname": "collections",
			"method": "POST"
		}
	],
	"name": "addReview",
	"ver": "24.8.2.2316",
	"description": null,
	"content": [
		"==OBJECT STRING==",
		"const data = req.body;\r",
		"log.error(data);\r",
		"// Verificar se req.user existe\r",
		"if (!req.user) {\r",
		"    log.error(\"User not authenticated\");\r",
		"    return fail(\"User not authenticated\");\r",
		"}\r",
		"\r",
		"const userId = req.user.id;\r",
		"\r",
		"if (!data) {\r",
		"    log.error(\"Missing required data\");\r",
		"    return { success: false, message: \"Missing required data\" };\r",
		"}\r",
		"\r",
		"try {\r",
		"    const currentTimestamp = Date.now();\r",
		"    // Insert one\r",
		"    const result = await entities.collections.createQueryBuilder()\r",
		"        .insert()\r",
		"        .values({\r",
		"            \"userId\": userId,\r",
		"            \"movieId\": data.movieId,\r",
		"            \"rating\": data.rating ? parseInt(data.rating) : null,\r",
		"            \"review\": data.review || null,\r",
		"            \"favourite\": data.favourite === true,\r",
		"            \"wishlist\": false,\r",
		"            \"private\": data.private === true,\r",
		"            \"title\": data.title || null,\r",
		"            \"release_date\": data.release_date ? new Date(data.release_date) : null,\r",
		"            \"genre\": data.genre ? JSON.stringify(data.genre) : null,\r",
		"            \"review_check\": true,\r",
		"            \"createdAt\": currentTimestamp,\r",
		"            \"updatedAt\": currentTimestamp, \r",
		"            \"updatedBy\": userId, \r",
		"            \"createdBy\": userId\r",
		"        })\r",
		"        .execute();\r",
		"        \r",
		"    return { success: true, data: result };\r",
		"} catch (error) {\r",
		"    log.error(\"Error inserting review:\", error);\r",
		"    console.log(\"Error details:\", error.message, error.parameters);\r",
		"    return { success: false, message: error.message || \"An error occurred while inserting the review\" };\r",
		"}\r",
		"\r",
		""
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": false,
	"jsscriptGroup": "040eb8d1-ffea-4ed8-b440-0c79f21beb3b",
	"package": "cea714f9-70c7-451c-8090-517e9e6854f8"
}