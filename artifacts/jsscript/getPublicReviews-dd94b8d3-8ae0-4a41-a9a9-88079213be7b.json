{
	"id": "dd94b8d3-8ae0-4a41-a9a9-88079213be7b",
	"createdAt": "2024-08-03T17:43:52.860Z",
	"createdBy": "admin",
	"globalScripts": [],
	"externalModules": [],
	"entitySets": [
		{
			"id": "7850ec31-7369-4a8b-a109-2b0d773cc88f",
			"name": "collections",
			"contextname": "collections"
		}
	],
	"apis": [],
	"name": "getPublicReviews",
	"ver": "24.8.8.168",
	"description": null,
	"content": [
		"==OBJECT STRING==",
		"const data = req.body;\r",
		"log.error(data);\r",
		"\r",
		"// Verificar se req.user existe\r",
		"if (!req.user) {\r",
		"    log.error(\"User not authenticated\");\r",
		"    return fail(\"User not authenticated\");\r",
		"}\r",
		"\r",
		"try {\r",
		"    const fields = {\r",
		"        \"userId\": \"uuid\",\r",
		"        \"movieId\": \"text\",\r",
		"        \"rating\": \"number\",\r",
		"        \"review\": \"text\",\r",
		"        \"favourite\": \"boolean\",\r",
		"        \"wishlist\": \"boolean\",\r",
		"        \"private\": \"boolean\",\r",
		"        \"title\": \"text\",\r",
		"        \"release_date\": \"timestamptz\",\r",
		"        \"genre\": \"json\",\r",
		"        \"review_check\": \"boolean\",\r",
		"        \"movieTitle\": \"text\"\r",
		"    };\r",
		"\r",
		"    const table = entities.collections;\r",
		"\r",
		"    const query = await table.find({\r",
		"        select: [\"userId\", \"movieId\", \"rating\", \"review\", \"favourite\", \"wishlist\", \"private\", \"title\", \"release_date\", \"genre\", \"review_check\", \"movieTitle\"],\r",
		"        where: {\r",
		"            private: false, // Simple conditions\r",
		"        },\r",
		"        cache: false, // Disables caching\r",
		"    });\r",
		"    \r",
		"    console.log(\"Query response:\", query);\r",
		"\r",
		"    // Transform the response to handle any special data types\r",
		"    const jsonResponse = query.map(item => ({\r",
		"        ...item,\r",
		"        release_date: item.release_date ? item.release_date.toISOString() : null,\r",
		"        genre: item.genre ? JSON.parse(item.genre) : null\r",
		"    }));\r",
		"\r",
		"    // Create a JSON object with the results\r",
		"    result.data = jsonResponse;\r",
		"    result.count = jsonResponse.length; // Add a count of the results\r",
		"\r",
		"    console.log(\"Returning JSON:\", JSON.stringify(result));\r",
		"\r",
		"} catch(error) {\r",
		"    log.error(\"Error in request: \", error);\r",
		"    return fail(error.message || \"An error occurred while fetching the data\");\r",
		"}"
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": true,
	"jsscriptGroup": "51653e2d-5205-489e-9d6c-de2862caeacb",
	"package": "cea714f9-70c7-451c-8090-517e9e6854f8"
}